<!-- NO LONGER USED: switched to ajax api design -->

{% extends "admin/base.html" %}

{% block admincontent %}
    <!-- main body -->
    <div class="content">
        <div class="button-group">
            <a href="{{ url_for('admin.submitquestion') }}" class="button1">Add Questions</a>
        </div>
        <div>
            <h2 class="pagetitle">Manage Questions</h2>
            <table id="questiontable">
                <thead>
                    <th>Title</th>
                    <th>Added Time</th>
                    <th>Difficulty</th>
                    <th colspan="3">Action</th>
                </thead>
                <tbody>
                    {% set diff = ['Easy', 'Medium', 'Hard', 'Expert']%}
                    {% for p in problems %}
                        <tr>
                            <td>{{p.title}}</td>
                            <td>{{p.dateAdded}}</td>
                            {%if p.difficulty == '0'%}
                            <td>Beginner</td>
                            {%elif p.difficulty == '1'%}
                            <td>Intermediate</td>
                            {%elif p.difficulty == '2'%}
                            <td>Advanced</td>
                            {%elif p.difficulty == '3'%}
                            <td>Expert</td>
                            {% endif %}
                            <!-- DONT TOUCH IT WORKS -->
                            <td><button type="submit" name="edituser" class="edit" onclick="window.location.href='{{url_for('admin.editquestion', urltitle=''.join(p.title.split()).lower())}}';">edit</button></td>
                            <td><button type="submit" name="deletequestion" class="delete" value="{{''.join(p.title.split()).lower()}}">delete</button></td>
                        </tr>
                    {% endfor %}
                    
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}

{% block jsfiles %}
    <!-- js to delete row and sort table-->
    <script>
        var index, table = document.getElementById('questiontable');
        for(var i =1;i < table.rows.length;i++)
        {   
            table.rows[i].cells[6].onclick = function()
            {
                //'this' refers to the button which is the child of a table row
                index = this.parentElement.rowIndex;
                table.deleteRow(index);
            };
        }

        //sort table
        $('th').click(function(){
        var table = $(this).parents('table').eq(0)
        var rows = table.find('tr:gt(0)').toArray().sort(comparer($(this).index()))
        this.asc = !this.asc
        if (!this.asc){rows = rows.reverse()}
        for (var i = 0; i < rows.length; i++){table.append(rows[i])}
        })

        function comparer(index) {
            return function(a, b) {
                var valA = getCellValue(a, index), valB = getCellValue(b, index)
                return $.isNumeric(valA) && $.isNumeric(valB) ? valA - valB : valA.toString().localeCompare(valB)
            }
        }
        function getCellValue(row, index){ return $(row).children('td').eq(index).text() }
    </script>
    {{ super() }}
{% endblock %}